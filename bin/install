#!/usr/bin/env php
<?php
/**
 * Uses composer to install all dependencies required to run or test the
 * project. Downloads composer if it doesn't already exist.
 *
 * PHP.Gt (http://php.gt)
 * @copyright Copyright â’¸ 2014 Bright Flair Ltd. (http://brightflair.com)
 * @license Apache Version 2.0, January 2004. http://www.apache.org/licenses
 */
$gtDir = "~/.gt";
if(!is_dir($gtDir)) {
	mkdir($gtDir);
}
chdir($gtDir);

var_dump(getcwd());
die();

// chdir("..");
if(!file_exists("composer.phar")) {
	$tempFile = "./.install.php";
	$installScript = file_get_contents("https://getcomposer.org/installer");
	file_put_contents($tempFile, $installScript);
	passthru("php $tempFile");
	unlink($tempFile);
}

passthru("./composer.phar install");

// OS-dependant stuff:
switch(PHP_OS) {
case "Darwin":
	// OSX
	// Install Homebrew to install MySQL and PHP versions.
	passthru("ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/"
		. "Homebrew/install/master/install)\"");

	// TODO: Manage packages for OSX.
	break;

default:
	break;
}
var_dump(PHP_OS);die();

echo "\n\nPHP.Gt successfully installed\n\n";